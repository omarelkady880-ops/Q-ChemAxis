{"version":3,"file":"mistralClient-C1z8irr5.js","sources":["../../src/lib/mistralClient.js"],"sourcesContent":["export async function sendMessage(messages, opts = {}) {\r\n  const apiUrl = import.meta.env.VITE_API_URL || (import.meta.env.DEV ? 'http://localhost:3001/api/mistral' : 'https://api.mistral.ai/v1/chat/completions');\r\n  const apiKey = import.meta.env.VITE_API_KEY;\r\n  const model = import.meta.env.VITE_MODEL || opts.model || 'mistral-medium';\r\n\r\n  // Ensure messages is an array\r\n  if (!Array.isArray(messages)) {\r\n    messages = [{ role: 'user', content: messages }];\r\n  }\r\n\r\n  const body = {\r\n    model,\r\n    messages,\r\n    max_tokens: 1024,\r\n    temperature: 0.7,\r\n    ...opts.body\r\n  };\r\n\r\n  // Debug logging in development\r\n  if (import.meta.env.DEV || import.meta.env.VITE_DEBUG === '1') {\r\n    const safeBody = { ...body };\r\n    console.debug('[Mistral] POST', apiUrl, { model: safeBody.model, messageCount: safeBody.messages.length });\r\n  }\r\n\r\n  try {\r\n    const res = await fetch(apiUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${apiKey}`\r\n      },\r\n      body: JSON.stringify(body)\r\n    });\r\n\r\n    const rawText = await res.text();\r\n    let data;\r\n    try {\r\n      data = rawText ? JSON.parse(rawText) : {};\r\n    } catch (e) {\r\n      data = rawText;\r\n    }\r\n\r\n    if (!res.ok) {\r\n      const errMsg = (data && data.error && data.error.message) ? data.error.message :\r\n                    (data && data.message) ? data.message :\r\n                    `HTTP ${res.status} ${res.statusText}`;\r\n      const err = new Error(`Mistral API error: ${errMsg}`);\r\n      err.raw = data;\r\n      err.status = res.status;\r\n      throw err;\r\n    }\r\n\r\n    // Extract response text from Mistral's response format\r\n    let text = '';\r\n    if (data && data.choices && data.choices[0] && data.choices[0].message) {\r\n      text = data.choices[0].message.content;\r\n    } else if (data && data.content) {\r\n      text = data.content;\r\n    } else if (typeof data === 'string') {\r\n      text = data;\r\n    }\r\n\r\n    return { text, raw: data, apiUrl };\r\n\r\n  } catch (err) {\r\n    console.error('[Mistral] sendMessage error:', err);\r\n    throw err;\r\n  }\r\n}\r\n\r\nexport default sendMessage;\r\n"],"names":["sendMessage","messages","opts","apiUrl","model","body","res","rawText","data","errMsg","err","text"],"mappings":"AAAA,eAAsBA,EAAYC,EAAUC,EAAO,GAAI,CACrD,MAAMC,EAAsG,6CAEtGC,EAAsCF,EAAK,OAAS,iBAGrD,MAAM,QAAQD,CAAQ,IACzBA,EAAW,CAAC,CAAE,KAAM,OAAQ,QAASA,EAAU,GAGjD,MAAMI,EAAO,CACX,MAAAD,EACA,SAAAH,EACA,WAAY,KACZ,YAAa,GACb,GAAGC,EAAK,IAAA,EASV,GAAI,CACF,MAAMI,EAAM,MAAM,MAAMH,EAAQ,CAC9B,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,kBAAgB,EAEnC,KAAM,KAAK,UAAUE,CAAI,CAAA,CAC1B,EAEKE,EAAU,MAAMD,EAAI,KAAA,EAC1B,IAAIE,EACJ,GAAI,CACFA,EAAOD,EAAU,KAAK,MAAMA,CAAO,EAAI,CAAA,CACzC,MAAY,CACVC,EAAOD,CACT,CAEA,GAAI,CAACD,EAAI,GAAI,CACX,MAAMG,EAAUD,GAAQA,EAAK,OAASA,EAAK,MAAM,QAAWA,EAAK,MAAM,QACxDA,GAAQA,EAAK,QAAWA,EAAK,QAC9B,QAAQF,EAAI,MAAM,IAAIA,EAAI,UAAU,GAC5CI,EAAM,IAAI,MAAM,sBAAsBD,CAAM,EAAE,EACpD,MAAAC,EAAI,IAAMF,EACVE,EAAI,OAASJ,EAAI,OACXI,CACR,CAGA,IAAIC,EAAO,GACX,OAAIH,GAAQA,EAAK,SAAWA,EAAK,QAAQ,CAAC,GAAKA,EAAK,QAAQ,CAAC,EAAE,QAC7DG,EAAOH,EAAK,QAAQ,CAAC,EAAE,QAAQ,QACtBA,GAAQA,EAAK,QACtBG,EAAOH,EAAK,QACH,OAAOA,GAAS,WACzBG,EAAOH,GAGF,CAAE,KAAAG,EAAM,IAAKH,EAAM,OAAAL,CAAA,CAE5B,OAASO,EAAK,CACZ,cAAQ,MAAM,+BAAgCA,CAAG,EAC3CA,CACR,CACF"}